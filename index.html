<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Truth or Dare Game</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            text-align: center;
            padding: 20px;
            margin: 0;
            background: #111;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            box-sizing: border-box;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        body.visible {
            visibility: visible;
            opacity: 1;
        }
        button {
            padding: 12px 24px;
            font-size: 18px;
            margin: 10px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background: #ffd700;
            color: #111;
            font-weight: bold;
            width: 80%;
            max-width: 300px;
        }
        input[type="number"] {
            padding: 10px;
            font-size: 18px;
            width: 80%;
            max-width: 200px;
            margin: 10px auto;
            border-radius: 5px;
            border: none;
            text-align: center;
        }
        #result, #number, #choice p, #timer {
            font-size: 20px;
            margin: 15px 0;
            padding: 0 10px;
        }
        #timer {
            color: #ff4500;
            font-weight: bold;
        }
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #111;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            animation: fadeOutOverlay 0.5s ease-in-out 1s forwards;
        }
        #overlay-text {
            font-size: 8vw;
            font-weight: 700;
            color: #ffd700;
            text-shadow: 0 0 12px #ffd700, 0 0 24px #ff4500, 0 0 36px #ff6347;
            animation: slideInRotate 0.25s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
            letter-spacing: 3px;
            text-align: center;
            transform: translateY(100px) rotate(-5deg);
            opacity: 0;
        }
        #wheel-container {
            margin: 20px 0;
            position: relative;
            display: none;
        }
        #wheel {
            max-width: 300px;
            width: 100%;
        }
        #spin-button {
            display: none;
        }
        #arrow {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 20px solid #ff4500;
            z-index: 10;
        }
        @keyframes slideInRotate {
            0% { transform: translateY(100px) rotate(-5deg); opacity: 0; }
            100% { transform: translateY(0) rotate(0deg); opacity: 1; }
        }
        @keyframes fadeOutOverlay {
            to { opacity: 0; visibility: hidden; }
        }
    </style>
</head>
<body>
    <audio id="backgroundMusic" autoplay loop>
        <source src="./Pressure.mp3" type="audio/mpeg">
        Your browser does not support the audio element. Please ensure the audio file is available and try again.
    </audio>

    <div id="overlay">
        <div id="overlay-text">TRUTH OR DARE</div>
    </div>

    <h1>Truth or Dare Game</h1>
    <p>Enter the number of players:</p>
    <input type="number" id="playerCount" min="2" placeholder="Number of players">
    <button onclick="startGame()">Start Game</button>

    <div id="wheel-container">
        <div id="arrow"></div>
        <canvas id="wheel" width="300" height="300"></canvas>
        <button id="spin-button" onclick="spinWheel()">Spin the Wheel</button>
    </div>
    <div id="number"></div>
    <div id="choice" style="display:none;">
        <p>Choose: Truth or Dare?</p>
        <button onclick="choose('truth')">Truth</button>
        <button onclick="choose('dare')">Dare</button>
    </div>
    <div id="result"></div>
    <div id="timer"></div>

    <script>
        const truths = [
            "What is your biggest fear?",
            "Have you ever lied to your best friend?",
            "What's a secret you have never told anyone?",
            "Who was your first crush?",
            "What’s the most embarrassing thing you've done?"
        ];

        const dares = [
            "Do 10 jumping jacks.",
            "Sing a song loudly.",
            "Dance without music for 30 seconds.",
            "Act like a monkey for 1 minute.",
            "Call a friend and confess you love ice cream passionately."
        ];

        let playerCount = 0;
        let currentPlayer = 0;
        let isSpinning = false;
        let timerInterval = null;

        // Audio error handling
        const audio = document.getElementById('backgroundMusic');
        audio.addEventListener('error', () => {
            console.error('Failed to load audio file. Ensure "./Pressure.mp3" is in the correct directory or use a valid URL.');
        });

        // Handle autoplay restrictions
        audio.muted = true;
        audio.play().then(() => {
            audio.muted = false;
        }).catch(err => {
            console.warn('Autoplay blocked:', err);
            document.addEventListener('click', () => {
                audio.muted = false;
                audio.play();
            }, { once: true });
        });

        window.addEventListener('load', () => {
            setTimeout(() => {
                document.body.classList.add('visible');
            }, 1500);
        });

        function startGame() {
            playerCount = parseInt(document.getElementById('playerCount').value);
            if (isNaN(playerCount) || playerCount < 2) {
                alert('Please enter a valid number of players (at least 2).');
                return;
            }
            clearTimer();
            drawWheel();
            spinWheel();
        }

        function drawWheel() {
            const canvas = document.getElementById('wheel');
            const ctx = canvas.getContext('2d');
            const radius = canvas.width / 2;
            const anglePerSegment = (2 * Math.PI) / playerCount;
            const colors = ['#ff4500', '#ffd700', '#1e90ff', '#32cd32', '#ff69b4'];

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < playerCount; i++) {
                ctx.beginPath();
                ctx.moveTo(radius, radius);
                ctx.arc(radius, radius, radius - 10, i * anglePerSegment, (i + 1) * anglePerSegment);
                ctx.fillStyle = colors[i % colors.length];
                ctx.fill();
                ctx.stroke();

                // Add player number
                ctx.save();
                ctx.translate(radius, radius);
                ctx.rotate(i * anglePerSegment + anglePerSegment / 2);
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 20px Georgia';
                ctx.textAlign = 'center';
                ctx.fillText(`P${i + 1}`, radius / 2, 0);
                ctx.restore();
            }
        }

        function spinWheel() {
            if (isSpinning) return;
            isSpinning = true;
            clearTimer();
            document.getElementById('wheel-container').style.display = 'block';
            document.getElementById('choice').style.display = 'none';
            document.getElementById('result').innerText = '';
            document.getElementById('number').innerText = '';

            const canvas = document.getElementById('wheel');
            let rotation = 0;
            const spinTime = 3000;
            const startTime = Date.now();
            const randomPlayer = Math.floor(Math.random() * playerCount) + 1;
            const anglePerSegment = 360 / playerCount;
            const targetAngle = (randomPlayer - 1) * anglePerSegment + Math.random() * anglePerSegment * 0.8 + anglePerSegment * 0.1;
            const totalRotation = 360 * 5 + targetAngle;

            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / spinTime, 1);
                const easeOut = 1 - Math.pow(1 - progress, 3);
                rotation = easeOut * totalRotation;

                canvas.style.transform = `rotate(${rotation}deg)`;

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    isSpinning = false;
                    currentPlayer = randomPlayer;
                    document.getElementById('number').innerText = `Player ${currentPlayer}, it’s your turn!`;
                    document.getElementById('choice').style.display = 'block';
                    document.getElementById('wheel-container').style.display = 'none';
                }
            }
            requestAnimationFrame(animate);
        }

        function startTimer() {
            clearTimer();
            let timeLeft = 30;
            document.getElementById('timer').innerText = `Time left: ${timeLeft}s`;

            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = `Time left: ${timeLeft}s`;
                if (timeLeft <= 0) {
                    clearTimer();
                    spinWheel();
                }
            }, 1000);
        }

        function clearTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            document.getElementById('timer').innerText = '';
        }

        function choose(option) {
            let output = '';
            if (option === 'truth') {
                const question = truths[Math.floor(Math.random() * truths.length)];
                output = `Your Truth question: ${question}`;
            } else if (option === 'dare') {
                const dare = dares[Math.floor(Math.random() * dares.length)];
                output = `Your Dare: ${dare}`;
            }
            document.getElementById('result').innerText = output;
            startTimer();
        }
    </script>
</body>
</html>
